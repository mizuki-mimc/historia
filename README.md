■サービス名
historia(仮)
→ history(歴史)とstory(物語)の派生元

■サービス概要
# どんなサービスなのかを３行で説明してください。
historia(仮)は娯楽小説の一貫性維持と創作活動の継続を支援するWebアプリです。
ユーザーは自身の物語の世界観や登場人物、ストーリー展開を整理・管理できます。
情報の煩雑化を防ぎ、物語を最後まで楽しく書き進められる環境を提供します。

■ このサービスへの思い・作りたい理由
# このサービスの題材となるものに関してのエピソードがあれば詳しく教えてください。
# このサービスを思いつくにあたって元となる思いがあれば詳しく教えてください。
自身が娯楽小説を書く際の願望を基に考えたサービスです。

娯楽小説は現在無料でだれでも手軽に始める事ができる環境が整っています。
その手軽さから、純文学とは異なり、やめない限り際限なく物語を広げることが可能です。

そういった背景から、物語が進むにつれて、
『この登場人物は誰とどんな関わりがあったか？』
『この場所の設定はどこまで公開していたか？』
『あの伏線は回収できたか？』
など、構成や設定を何度も確認・読み返す必要が生じる場面が多々あります。
そして、こうした情報過多により、物語の一貫性が損なわれるリスクが高まっていると感じております。

私自身、メモ機能などで構成や設定を管理していても、キャラの性格がぶれたり、説明していない設定を突然出すなど徐々に一貫性が損なわれ、読者にその点を指摘されることが多々ありました。
また、指摘ではなく心無いコメントが寄せられ途中で辞めてしまった物語も複数あります。

こうした煩雑になりがちな構成や設定を、本サービスで管理・整理することで、  
作者が創作を楽しみながら物語の一貫性を保ち、読者もより作品を楽しめる環境を作ることを目指しています。

■ ユーザー層
# 決めたユーザー層についてどうしてその層を対象にしたのかそれぞれ理由を教えてください。

- 構成・設定管理の煩雑さに悩む娯楽小説の作者（趣味や副業で執筆している層）:
  継続的に物語を執筆する中で情報量が膨大になりがちなため、簡単に整理・見返し・管理できる環境を提供することが価値になると考えたため。

- 頭に浮かんだ構成・設定を可視化したい娯楽小説の作者（趣味や副業で執筆している層）:
  メモ帳やノートでは断片的・非構造的な情報管理になりやすいため、構造化された形で視覚的に整理できる環境を提供することで創作活動の質向上を支援したいと考えています。

- 娯楽小説を始めたい、始めてまもないの作者:
  創作初心者は「何からどう整理してよいかわからない」という壁があり、特に情報の煩雑化が起こりやすい傾向があると感じています。その壁を越えやすくするために、項目が明確でガイド的に使える設計を目指しています。

■サービスの利用イメージ
# ユーザーがこのサービスをどのように利用できて、それによってどんな価値を得られるかを簡単に説明してください。

ユーザーは、自身の創作物(ストーリー)に登場する構成(プロット)・世界観(ワールドガイド)・人物(キャラクター)・伏線（フラグ）を整理・可視化しながら物語を構築できます。
情報の煩雑化を防ぎ、一貫性のある物語作成を支援します。

1. ユーザーはログインし、ストーリー（掲示板のような形）を新規作成
2. ストーリー内には「プロット」「ワールドガイド」「キャラクター」「フラグ」の四項目が存在し、まず「ワールドガイド」「キャラクター」「フラグ」を任意数作成
3. 「プロット」は同じストーリー内の「ワールドガイド」「キャラクター」「フラグ」情報を活用して作成
4. 作成した「プロット」を基に各小説投稿サイトにて創作物を執筆
5. 小説投稿サイトへの投稿と並行して、本サービスへ情報を随時追加・更新
6. 本サービスを見返しながら、物語の整合性を維持しつつ物語完結まで完走

■ ユーザーの獲得について
# 想定したユーザー層に対してそれぞれどのようにサービスを届けるのか現状考えていることがあれば教えてください。
- 自身の小説投稿用SNSでの周知
- 自身の各小説投稿用アカウントでの周知

■ サービスの差別化ポイント・推しポイント
# 似たようなサービスが存在する場合、そのサービスとの明確な差別化ポイントとその差別化ポイントのどこが優れているのか教えてください。
# 独自性の強いサービスの場合、このサービスの推しとなるポイントを教えてください。

【似たようなサービス】
- 「物語の幹(参考URL:https://tale-trunk.com/)」: 
  直感的に各情報を管理できる点が差別化点としてあげられます。
  構成としては似通っており、ログイン> 新しい物語追加> 物語グループ追加（自由記述）> 物語パーツ追加(自由記述)となっていました。
  一つの物語に対して、複数の物語グループと物語パーツで管理の自由度を上げていると考えます。
  しかし、初心者や始めたいと考えているユーザーにはどこから手を付けていいか、少しわかりづらい設計ではないかとも感じました。
  本サービスでは「キャラクター」項目であれば年齢、性別、名前など、ある程度管理できる情報を絞ることで、初心者にもわかりやすい項目・ルート設計をしたいと考えています。

- 「WorldType(参考URL:https://www.world-type.com/)」: 
  「プロット」や「フラグ」の管理ができる点が差別化点としてあげられます。
  サービス内容としては本サービスと同じく「世界観設定（本アプリではワールドタイプ）」「人物設定（本アプリではキャラクター）」の二種が物語一つごとに設定することができ、設定できる項目は比較的多いと感じました。
  しかし、本サービスでいう「プロット」のような、その人物たちはどこで登場し、その場面ではどういう行動を行うなどの情報や「フラグ」管理はできないと感じました。
  本サービスでは、情報過多で物語の一貫性が損なわれることを防ぐ目的のものですので、上記二項目は必要な機能かつ差別化点と考えています。

■ 機能候補
# 現状作ろうと思っている機能、案段階の機能をしっかりと固まっていなくても構わないのでMVPリリース時に作っていたいもの、本リリースまでに作っていたいものをそれぞれ分けて教えてください。

【MVPリリース時】
- [] ソーシャルログイン機能 (Googleログインのみ使用予定)
- [] 作成機能 (ストーリー、プロット、ワールドガイド、キャラクター、フラグ)
- [] 削除機能 (ストーリー、プロット、ワールドガイド、キャラクター、フラグ)
- [] 編集機能 (ストーリー、プロット、ワールドガイド、キャラクター、フラグ)
- [] 自動保存機能 (ストーリー、プロット、ワールドガイド、キャラクター、フラグ)
- [] ステータス変更機能（公開、下書き）
- [] ステータス表示機能 (ストーリー一覧、詳細)
- [] 画像アップロード機能
- [] フラグ作成・回収管理機能

【本リリース時】
- [] 検索機能※オートコンプリート (ストーリー、ワールドガイド、キャラクター、フラグ)
- [] 未登録での作成機能※ゲスト投稿 (ストーリー、プロット、ワールドガイド、キャラクター、フラグ)
- [] 公開ストーリーは一覧画面でカラー表示
- [] 素材ライブラリAPIとの連携 (ワールドガイド、キャラクターに実装)
- [] 参考テンプレート化機能 (ストーリー構成に実装)
- [] 構成チェック機能 (ストーリー構成に実装)

■ 機能の実装方針予定
# 一般的なCRUD以外の実装予定の機能についてそれぞれどのようなイメージ(使用するAPIや)で実装する予定なのか現状考えているもので良いので教えて下さい。

- ソーシャルログイン機能:
  登録障壁を低くしたいため、ユーザー自身のGoogleアカウントを利用したログイン形式に使用と考えています。
  Google OAuth2認証を行うため、gem `omniauth-google-oauth2`を使用予定です。

- 自動保存機能 (ストーリー、プロット、ワールドガイド、キャラクター、フラグ):
  ユーザーがストーリー制作中に意識せずに作業に集中できるよう、「ストーリー」「プロット」「ワールドガイド」「キャラクター」「フラグ」は自動保存機能を実装予定です。
  フォーム入力・編集時に一定間隔または入力イベントをトリガーとして、自動的にバックエンド側へ非同期リクエスト（AJAX）を送信し、保存を行おうと考えています。
  作業時のストレスや保存忘れによるデータ損失のリスクを回避するため、ユーザー操作可能な「保存」ボタンは作成しません。
  また、未登録ユーザーのゲスト投稿時はセッションストレージ側に保存し、登録・ログイン時にサーバー側へ保存できる設計をしたいと考えています。

- ステータス変更機能（公開、下書き）
  ユーザーが作成したストーリーのステータスを公開状態と下書き状態に切り替えられる機能です。
  切り替えたステータスはストーリー一覧、詳細画面で表示されるだけでなく、一覧ページでは後述する、ステータスにより色も変更される機能にもつながります。

- ステータス表示機能 (ストーリー一覧、詳細):
  ストーリーの一覧画面・詳細画面には、現在のステータス（「下書き」「公開」）を表示予定です。
  一覧画面では各ストーリーのカードに「公開」「下書き」のステータス表示を行い、ユーザーがステータスを一目で把握できるようにします。
  ストーリー詳細画面でもタイトル付近などに現在のステータスを表示します。

- 画像アップロード機能:
  「ワールドガイド」や「キャラクター」に関して、ビジュアルイメージや参考資料（他作品・現実の参考にしたキャラクター、風景、車両、衣装など）をアップロードできる機能を実装予定です。
  物語制作時の想像力向上や設定の明確化に役立てることを目的とします。
  開発初期段階ではActive Storage を利用し、ローカルストレージに保存。将来的にはクラウドストレージの使用も検討しています。

- フラグ作成・回収管理機能:
  ユーザーは「フラグ」から任意数のフラグを作成可能で、各フラグには「作成」「回収」のチェックボックスが用意されます。
  チェック操作は「プロット」画面内でのみ実行可能とし、ユーザーはストーリー進行に応じて使用するフラグの状態（「作成」「回収」）を管理できる設計とします。
  「プロット」画面でチェック状態を変更すると、その状態は非同期(AJAX)で即時保存され、「フラグ一覧」画面でも同期された状態が表示されます。
  ※「フラグ一覧」側ではチェック操作は行えず、状態の確認のみ可能とします。

- 検索機能(オートコンプリート):
  各項目ごとに検索できるようにする予定です。また、膨大な情報量でも操作性をできる限り担保したいためオートコンプリート形式を使用予定です。
  Stimulus Autocomplete（https://github.com/afcapel/stimulus-autocomplete）を使用する予定、APIエンドポイントを用意し非同期で候補を返すよう設計しようと考えています。

- 未登録での作成機能(ゲスト投稿):
  一度触ってみたいけど登録はまだ抵抗が残る方に向け、ログインしていないユーザーでも「ストーリー」「プロット」「ワールドガイド」「キャラクター」「フラグ」を作成できる機能を予定しています。
  作成データはセッションストレージに一時的に保存させ、ブラウザやタブを閉じると消える仕様とする予定です。ユーザー登録に至らなかったユーザーの次回未登録作成時の利便性向上のため、ローカルストレージではなくセッションストレージを検討しています。(登録に至らなかったユーザーは基本的に一時的な利用と想定し、不要なデータを残さないためです。)
  このまま続けたいと考えたユーザーは、登録・ログインすることでセッションストレージに保存したデータをユーザー登録後のデータとして保存する処理の実装を考えています。

- 公開ストーリーは一覧画面でカラー表示:
  サービス全体は基本的にモノクロ基調のUIとし、公開されたストーリーのみ一覧画面でカラー表示を実装予定です。
  これにより、小説投稿サイトで投稿された作品が際立ち、ユーザーの達成感やモチベーション向上につながるUXを提供したいと考えています。
  デフォルトのモノクロ基調は、ユーザーの集中力や発想の妨げにならないよう配慮したものです。
  UI面では「公開」ステータスのストーリーにCSSクラスを適用し、カード全体やサムネイル等をカラー化します。一方、非公開（下書き）状態のストーリーはモノクロ表示のままにし、状態の違いを視覚的に明確に区別できるようにします。

- 素材ライブラリAPIとの連携(ワールドガイド、キャラクターに実装):
  ビジュアルイメージを手軽に取り入れたいユーザーへのサポートとして、Unsplash API（写真）との連携を予定しています。
  主に「ワールドガイド」や「キャラクター」の作成画面で、素材検索・挿入が行えるようにし、イメージの補完や発想の補助を目的とします。
  Unsplash APIを選択した理由はイメージの補完と発想の補助を目的としているため、写真のみで十分と判断したことに加え、導入の手軽さから初期APIとして適していると考えたからです。
  API経由でキーワード検索を行い、候補画像の一覧を非同期で取得します。ユーザーが選択した素材は 外部リンクの形で参照する形式とし、画像のダウンロード・再配布は行わず、著作権面も配慮として、クレジット表示も推奨していく予定です。
  将来的に、ユーザー数や利用頻度の増加によりレートリミットの問題が生じた際には、Pexels APIの採用も視野に入れて対応検討する想定です。

- 参考テンプレート化機能(ストーリー構成に実装):
  物語制作の初心者やアイデア整理に悩むユーザーのために、プロットページの構成メモ作成時に参考にできる「起承転結」や「三幕構成」など代表的なストーリー構成テンプレートを数種類用意します。
  しかし、娯楽小説は作者の創作意欲次第で無限に広がり、情報量も膨大になることを前提に本サービスを企画しています。そのため、テンプレートはあくまで「ガイドライン」として提供し、ユーザーが枠にとらわれず自由に編集・拡張できる設計とする予定です。
  また、構成メモはデフォルトで白紙状態から始め、ユーザーの好みや創作スタイルに合わせた柔軟な使い分けが可能にする予定です。

- 構成チェック機能(プロットに実装):
  膨大な情報を整理しながら物語制作を進められるよう、「プロットチェック機能」を実装予定です。この機能は「プロット」に実装予定です。
  
  一つのストーリー毎に「章を追加するボタン」を押すことにより複数の「プロット」の追加ができます。「プロット」では同じストーリー内の作成済み「ワールドタイプ」「キャラクター」「フラグ」から任意数選択できます。
  ユーザーの「プロット」の内容を自動で照合することで、記述漏れや一貫性・整合性の保持を支援します。

  具体的には、ChatGPT APIと連携し、以下のチェックを行う想定です。
  ・ワールドタイプ：選択されたワールドタイプに関連する描写や舞台設定がプロット内で表現されているか。
  ・キャラクター：選択したキャラクターがプロット内で登場・言及・行動しているか。
  ・フラグ：作成・回収予定のフラグに関連する描写や伏線が適切に組み込まれているか。
  
  チェックは「プロット」ごとに任意のタイミングで実行でき、チェック結果は簡潔な文面として画面上に表示。ユーザーは不足や矛盾を早期に把握し、作品の完成度向上や整合性維持に活用できます。
  本サービスが目指す「情報が膨大になっても煩雑化・ミスを防ぐ」ための機能の一つとして位置付ける予定です。
  
■ 技術スタック
- Rails:
  Rails 7.2.2.1 を採用しようと考えています。
  最新のRails 8.0.2との比較点としてGemがまだ8系に完全対応していないケースを考え、主要Gemとの互換性および安定運用を優先し7.2系を選択しました。将来的なアップデートを見据えてコードは最新Rails対応を意識して設計したいと考えています。

- Ruby:
  Ruby 3.3.8を採用しようと考えています。
  Rails 7.2系との互換を考え、Rubyは～3.3系までと考えています。(3.4系以降はRails7.2系リリース以降にリリースされているため、公式サポート外の可能性が高いと判断しています)

- データベース:
  PostgreSQLを採用しようと考えています。
  実装予定機能からActive Recordを頻繁に利用すると考えられ、PostgreSQLには多数の最適化が搭載されていると考えており採用しました。

- デプロイサーバー:
  Renderを採用しようと考えています。
  同水準のサーバー候補としてHerokuと比較検討しましたが、RailsやDockerとの互換性はどちらも高いものの、今回のサービス規模においてはコスト面でRenderが優れていると判断しました。
  加えて、Renderはスケーリング設定の細かさ(将来の機能増加を想定した設計のため)やデプロイの自由度(スムーズな機能追加・運用改善のため)といった運用の柔軟性に優れており、本サービスに適していると考えています。

- 使用想定のgem
  ・devise : ユーザー認証用(ユーザー・ログイン機能の基本部分)
  ・omniauth-google-oauth2 : Googleアカウント認証 (OAuth2)
  ・pg_search または ransack : 検索機能（オートコンプリートAPI用）
  ・stimulus-rails : JavaScriptフレームワーク用
  ・tailwindcss-rails : CSSフレームワーク用
  ・stimulus-autocomplete : オートコンプリート機能
  ・active_storage_validations : 画像アップロード時のバリデーション用
  ・gretel : パンくずリスト生成
  ・kaminari : ページネーション用
  ・rails-i18n : 日本語化対応
  ・cancancan : 権限管理（個人開発のため）
  ・rails_admin : 管理画面用
  ・resque : 非同期処理（ChatGPT API連携の際など）
  ・faraday : 外部API連携（複数API連携予定のため）
  ・figaro : 環境変数管理
  ・rubocop : コード品質ツール
  ・rspec-rails : テストフレームワーク
  ・factory_bot_rails : テストデータ作成用
  ・capybara : 結合テスト用
